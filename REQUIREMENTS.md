## REQUIREMENTS.md  (改訂 2025‑08‑07)

Discord 議事録自動化システム — *オンデマンド要約方式*

### ▼ 目的 / 背景

* Discord ボイスチャットを **リアルタイムで録音 & 議事録化**。
* **録音し忘れ** や **途中参加** でも、30 分遡って内容を把握できる安心感を提供。
* Whisper には Rust 製 HTTP サーバー **Vibe** を採用し、Bot 側は HTTP 1 本で統合。

---

### ▼ 機能一覧（ユーザー視点）

| # | 機能                           | 説明                                                                                                              |
| - | ---------------------------- | --------------------------------------------------------------------------------------------------------------- |
| 1 | **自動録音 +30 分リングバッファ**        | VC 参加と同時に録音開始。Opus → PCM → Vibe → Redis に保存。Redis は TTL=1 800 秒で自動蒸発。                                           |
| 2 | **30 分遡り保存**                 | パネルの **\[過去30分を保存]** ボタンで直近 30 分の全文を **対象 VC のテキストチャットに投稿**。                                                    |
| 3 | **オンデマンド要約** (`/sofar` / 📜) | 直近 30 分の全文を **呼び出し時にだけ** LLM 要約し、**同じ VC のテキストチャットへ投稿**。                                                        |
| 4 | **複数 VC 同時録音 (最大4)**         | サーバー内にある会議室を最大 **4 室まで** 並列録音。録音枠が満杯でも **パネルの \[🔴録音開始]／`/record start` を押した VC は必ず録音** し、人数が最少の自動録音 VC を待機へ回す。 |
| 5 | **常設コントロールパネル UI**           | VC テキストチャット最上部に固定された Embed。録音状態・経過時間・操作ボタン（🔴停止・📜今まで・💾過去30分保存・🔴録音開始）を一目で確認。                                  |

> 🔖 要約仕様：300〜500 字／日本語。全文が 2 000 token を超える場合は「部分→統合」の 2 段要約。

---

### ▼ 非機能要件（抜粋）

* **コスト** : LLM は呼び出し時のみ → 1 時間会議×3 回要約 ≈ **0.5 円**
* **レイテンシ** : /sofar 応答 1 shot ≈ 1 s、最長でも 3 s
* **セキュリティ** : 音声は Redis 内のみ・30 分後消滅。
* **運用** : Cloud Run ワンクリックデプロイ・オンプレ GPU は Vibe Docker

---
